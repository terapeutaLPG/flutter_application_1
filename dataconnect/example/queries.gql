mutation CreateUser($email: String!, $passwordHash: String!) @auth(level: PUBLIC, insecureReason: "This operation is safe to expose to the public") {
  user_insert(data: {email: $email, passwordHash: $passwordHash, createdAt_expr: "request.time"})
}

query GetUserByEmail($email: String!) @auth(level: PUBLIC, insecureReason: "This operation is safe to expose to the public") {
  users(where: {email: {eq: $email}}) {
    id
    email
    passwordHash
  }
}

mutation UpdateLastLoginAt @auth(level: USER) {
  user_update(key: {id_expr: "auth.uid"}, data: {lastLoginAt_expr: "request.time"})
}

query GetCurrentUser @auth(level: USER) {
  user(key: {id_expr: "auth.uid"}) {
    id
    email
    createdAt
    lastLoginAt
  }
}